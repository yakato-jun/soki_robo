<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 860 620" font-family="sans-serif" font-size="13">
  <defs>
    <marker id="arrow" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="#555"/>
    </marker>
    <marker id="arrow-red" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="#c0392b"/>
    </marker>
    <marker id="arrow-grn" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="#27ae60"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="860" height="620" fill="#fafafa" rx="8"/>
  <text x="430" y="28" text-anchor="middle" font-size="16" font-weight="bold" fill="#333">soki_robo System Block Diagram</text>

  <!-- ===== LiDAR (top-right) ===== -->
  <rect x="660" y="50" width="170" height="60" rx="6" fill="#e67e22" stroke="#ca6f1e" stroke-width="1.5"/>
  <text x="745" y="75" text-anchor="middle" fill="#fff" font-weight="bold" font-size="14">RP LiDAR A1M8</text>
  <text x="745" y="95" text-anchor="middle" fill="#fdebd0" font-size="11">/dev/ttyUSB0</text>

  <!-- ===== Raspberry Pi 5 ===== -->
  <rect x="250" y="50" width="300" height="80" rx="6" fill="#2980b9" stroke="#1a5276" stroke-width="1.5"/>
  <text x="400" y="78" text-anchor="middle" fill="#fff" font-weight="bold" font-size="15">Raspberry Pi 5</text>
  <text x="400" y="98" text-anchor="middle" fill="#d6eaf8" font-size="11">Python / ROS2</text>
  <text x="400" y="115" text-anchor="middle" fill="#d6eaf8" font-size="11">GPIO UART (/dev/ttyAMA0) &amp; I2C-1</text>

  <!-- ===== UPS Plus (EP-0136) ===== -->
  <rect x="20" y="170" width="210" height="110" rx="6" fill="#27ae60" stroke="#1e8449" stroke-width="1.5"/>
  <text x="125" y="195" text-anchor="middle" fill="#fff" font-weight="bold" font-size="14">UPS Plus EP-0136</text>
  <text x="125" y="215" text-anchor="middle" fill="#d5f5e3" font-size="10">MCU: 0x17 / INA219: 0x40, 0x45</text>
  <text x="125" y="233" text-anchor="middle" fill="#d5f5e3" font-size="10">FCP / AFC / SFCP / BC1.2</text>
  <text x="125" y="251" text-anchor="middle" fill="#d5f5e3" font-size="10">4.5V5A / 5V2.5A / 9V2A / 12V1.5A</text>
  <text x="125" y="269" text-anchor="middle" fill="#d5f5e3" font-size="10">※ USB PD 非対応</text>

  <!-- ===== MSPM0 Core Board ===== -->
  <rect x="310" y="200" width="220" height="60" rx="6" fill="#8e44ad" stroke="#6c3483" stroke-width="1.5"/>
  <text x="420" y="224" text-anchor="middle" fill="#fff" font-weight="bold" font-size="14">MSPM0G3507 コアボード</text>
  <text x="420" y="248" text-anchor="middle" fill="#e8daef" font-size="11">Modbus RTU Slave / リアルタイム制御</text>

  <!-- ===== MSPM0 Expansion Board ===== -->
  <rect x="270" y="320" width="310" height="60" rx="6" fill="#6c3483" stroke="#512e5f" stroke-width="1.5"/>
  <text x="425" y="345" text-anchor="middle" fill="#fff" font-weight="bold" font-size="13">MSPM0 拡張ボード (Yahboom)</text>
  <text x="425" y="365" text-anchor="middle" fill="#d7bde2" font-size="11">Motor Driver / IMU / Encoder 接続</text>

  <!-- ===== PC (middle-right) ===== -->
  <rect x="620" y="195" width="160" height="50" rx="6" fill="#34495e" stroke="#2c3e50" stroke-width="1.5"/>
  <text x="700" y="218" text-anchor="middle" fill="#fff" font-weight="bold" font-size="13">PC (Windows)</text>
  <text x="700" y="235" text-anchor="middle" fill="#aeb6bf" font-size="10">CCS Theia / FW書込</text>

  <!-- ===== IMU ===== -->
  <rect x="460" y="430" width="130" height="50" rx="6" fill="#7f8c8d" stroke="#616a6b" stroke-width="1.5"/>
  <text x="525" y="453" text-anchor="middle" fill="#fff" font-weight="bold" font-size="13">9-axis IMU</text>
  <text x="525" y="470" text-anchor="middle" fill="#d5d8dc" font-size="11">I2C (0x23)</text>

  <!-- ===== Encoders ===== -->
  <rect x="290" y="430" width="80" height="50" rx="6" fill="#7f8c8d" stroke="#616a6b" stroke-width="1.5"/>
  <text x="330" y="452" text-anchor="middle" fill="#fff" font-weight="bold" font-size="12">Encoder</text>
  <text x="330" y="468" text-anchor="middle" fill="#d5d8dc" font-size="11">x2</text>

  <!-- ===== Motors ===== -->
  <rect x="390" y="530" width="120" height="40" rx="6" fill="#bdc3c7" stroke="#95a5a6" stroke-width="1.5"/>
  <text x="450" y="555" text-anchor="middle" fill="#333" font-weight="bold" font-size="12">DC Motor x2</text>

  <!-- ===== 18650 Batteries (UPS) ===== -->
  <rect x="20" y="320" width="120" height="50" rx="6" fill="#f39c12" stroke="#d68910" stroke-width="1.5"/>
  <text x="80" y="343" text-anchor="middle" fill="#fff" font-weight="bold" font-size="12">18650 x2</text>
  <text x="80" y="360" text-anchor="middle" fill="#fef9e7" font-size="10">3.7V parallel</text>

  <!-- ===== AC Adapter ===== -->
  <rect x="20" y="60" width="120" height="60" rx="6" fill="#f39c12" stroke="#d68910" stroke-width="1.5"/>
  <text x="80" y="82" text-anchor="middle" fill="#fff" font-weight="bold" font-size="12">AC Adapter</text>
  <text x="80" y="98" text-anchor="middle" fill="#fef9e7" font-size="10">USB-C 5V 2.5A〜</text>
  <text x="80" y="112" text-anchor="middle" fill="#fef9e7" font-size="10">急速充電対応可</text>

  <!-- ===== Yahboom Li Battery ===== -->
  <rect x="160" y="430" width="110" height="50" rx="6" fill="#f39c12" stroke="#d68910" stroke-width="1.5"/>
  <text x="215" y="448" text-anchor="middle" fill="#fff" font-weight="bold" font-size="11">Yahboom Li電池</text>
  <text x="215" y="468" text-anchor="middle" fill="#fef9e7" font-size="10">4400mAh</text>

  <!-- ===== Lines ===== -->

  <!-- AC Adapter → UPS (USB-C) -->
  <line x1="80" y1="120" x2="80" y2="168" stroke="#c0392b" stroke-width="2" marker-end="url(#arrow-red)"/>
  <text x="88" y="150" fill="#c0392b" font-size="10">USB-C</text>

  <!-- 18650 → UPS -->
  <line x1="80" y1="320" x2="80" y2="282" stroke="#c0392b" stroke-width="2" marker-end="url(#arrow-red)"/>

  <!-- UPS → RPi (5V GPIO) -->
  <line x1="185" y1="170" x2="248" y2="110" stroke="#c0392b" stroke-width="2.5" marker-end="url(#arrow-red)"/>
  <text x="188" y="138" fill="#c0392b" font-size="10" font-weight="bold">5V GPIO</text>

  <!-- RPi ↔ UPS (I2C) -->
  <line x1="270" y1="130" x2="215" y2="170" stroke="#2ecc71" stroke-width="1.5" stroke-dasharray="6,3" marker-end="url(#arrow-grn)"/>
  <text x="225" y="160" fill="#27ae60" font-size="10">I2C-1</text>

  <!-- RPi ↔ Core Board (GPIO UART) -->
  <line x1="400" y1="130" x2="420" y2="198" stroke="#555" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="430" y="160" fill="#555" font-size="10">GPIO UART</text>
  <text x="430" y="172" fill="#555" font-size="10">Modbus RTU</text>

  <!-- RPi ↔ LiDAR (USB, top-right) -->
  <line x1="550" y1="80" x2="658" y2="75" stroke="#555" stroke-width="1.5" marker-end="url(#arrow)"/>
  <text x="595" y="70" fill="#555" font-size="10">USB</text>

  <!-- PC → Core Board (USB, firmware, middle-right) -->
  <line x1="620" y1="220" x2="532" y2="225" stroke="#555" stroke-width="1.5" stroke-dasharray="4,4" marker-end="url(#arrow)"/>
  <text x="560" y="214" fill="#555" font-size="10">USB (FW書込)</text>

  <!-- Core Board ↔ Expansion Board -->
  <line x1="420" y1="260" x2="425" y2="318" stroke="#555" stroke-width="2"/>
  <text x="435" y="295" fill="#555" font-size="10">ピンヘッダ</text>

  <!-- Expansion Board → IMU (I2C) -->
  <line x1="490" y1="380" x2="520" y2="428" stroke="#555" stroke-width="1.5" stroke-dasharray="6,3" marker-end="url(#arrow)"/>
  <text x="520" y="410" fill="#555" font-size="10">I2C</text>

  <!-- Expansion Board → Encoders (GPIO) -->
  <line x1="370" y1="380" x2="340" y2="428" stroke="#555" stroke-width="1.5" marker-end="url(#arrow)"/>
  <text x="340" y="410" fill="#555" font-size="10">GPIO</text>

  <!-- Expansion Board → Motors (Motor Driver) -->
  <line x1="425" y1="380" x2="450" y2="528" stroke="#c0392b" stroke-width="1.5" marker-end="url(#arrow-red)"/>
  <text x="455" y="500" fill="#555" font-size="10">UART1</text>

  <!-- Yahboom Li Battery → Expansion Board -->
  <line x1="215" y1="430" x2="268" y2="370" stroke="#c0392b" stroke-width="2" marker-end="url(#arrow-red)"/>
  <text x="218" y="400" fill="#c0392b" font-size="10">電源</text>

  <!-- ===== Legend ===== -->
  <rect x="640" y="430" width="200" height="110" rx="4" fill="#fff" stroke="#ccc"/>
  <text x="650" y="450" font-size="11" font-weight="bold" fill="#333">Legend</text>
  <line x1="650" y1="468" x2="680" y2="468" stroke="#c0392b" stroke-width="2.5"/>
  <text x="686" y="472" font-size="11" fill="#333">Power</text>
  <line x1="650" y1="488" x2="680" y2="488" stroke="#555" stroke-width="1.5"/>
  <text x="686" y="492" font-size="11" fill="#333">Data (UART / USB)</text>
  <line x1="650" y1="508" x2="680" y2="508" stroke="#2ecc71" stroke-width="1.5" stroke-dasharray="6,3"/>
  <text x="686" y="512" font-size="11" fill="#333">Data (I2C)</text>
  <line x1="650" y1="528" x2="680" y2="528" stroke="#555" stroke-width="1.5" stroke-dasharray="4,4"/>
  <text x="686" y="532" font-size="11" fill="#333">開発時のみ (USB)</text>
</svg>
