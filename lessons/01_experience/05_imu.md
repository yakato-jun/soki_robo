# IMUを読む

**目的**: 内界センサの体験。「自分がどんな姿勢かを知る」。

---

## IMUとは

**Inertial Measurement Unit**（慣性計測装置）。
加速度・角速度・地磁気を測るセンサです。

### 9軸の意味

「9軸」と聞くと複雑に聞こえますが、3種類 × 3方向です。

| センサ | 何を測る | 3軸の意味 |
| ------ | -------- | --------- |
| 加速度センサ | どの方向にどれだけ力がかかっているか | x, y, z方向の加速度 |
| ジャイロセンサ | どの軸周りにどれだけ回っているか | x, y, z軸周りの角速度 |
| 地磁気センサ | どの方向に磁場があるか（≒方位） | x, y, z方向の地磁気 |

- 加速度 → 「どっちに動いているか」
- 角速度 → 「どれだけ回っているか」
- 地磁気 → 「どっちが北か」

3つ合わせると「今どんな姿勢で、どっちを向いていて、どう動いているか」が分かります。

---

## Pythonで値を読み取る

```python
# イメージ
imu = robot.get_imu()

print(f"加速度: x={imu.accel_x:.2f}, y={imu.accel_y:.2f}, z={imu.accel_z:.2f}")
print(f"角速度: x={imu.gyro_x:.2f}, y={imu.gyro_y:.2f}, z={imu.gyro_z:.2f}")
print(f"地磁気: x={imu.mag_x:.2f}, y={imu.mag_y:.2f}, z={imu.mag_z:.2f}")
```

---

## やってみよう

### 静止状態で読む

ロボットを机の上に置いて、動かさずに値を読んでみましょう。

```python
import time

for i in range(10):
    imu = robot.get_imu()
    print(f"accel_z={imu.accel_z:.2f}, gyro_z={imu.gyro_z:.2f}")
    time.sleep(0.5)
```

**気づくこと:**
- 静止しているのに加速度zが約9.8 → **重力**を測っている
- 角速度は0に近いが、完全な0ではない → **ノイズ**がある

### ロボットを手で傾ける

ロボットを手で持って、ゆっくり傾けてみましょう。

- 前に傾ける → 加速度xが変わる
- 横に傾ける → 加速度yが変わる
- 回す → 角速度zが変わる

### ロボットを手で回す

ロボットを机の上でゆっくり回してみましょう。

**気づくこと:**
- 角速度zは回している間だけ値が出る（回転の速さ）
- 地磁気は向きによって値が変わる（方位）
- **IMUが示す「前」とロボットの「前」が一致しない場合がある**

---

## 座標のズレを体感する

最後の「IMUの前とロボットの前が一致しない」は重要です。

IMUセンサはロボットの基板に載っていますが、
基板の向きとロボットの「前」は必ずしも同じではありません。

- IMUは「センサ座標系」で値を返す
- ロボットの「前」は「ロボット座標系」

**この2つの座標系がズレている場合、IMUの値をそのまま使うと間違う。**

これが01_roadmapで話した「座標系」の問題です。
解決する道具（座標変換）は大枠2の線形代数で出てきます。

---

## 気づいてほしいこと

- IMUは「自分の動き」を測る内界センサ
- 静止していてもノイズがある（完璧なセンサは存在しない）
- 静止していても重力が測れる（これが姿勢推定に使える）
- センサの向きとロボットの向きは必ずしも一致しない（座標系の問題）
- 角速度を累積すれば向きが分かるが、ノイズも累積する（ドリフト問題）

> **補足**: このロボットのIMUはクォータニオン（四元数）出力にも対応しています。
> 四元数については大枠2の線形代数で「へー」レベルで触れます。
> 今は「そういう出力もあるんだ」で十分です。

---

**次のレッスン**: → #09 numpy入門 (`01_experience/07_numpy`)
