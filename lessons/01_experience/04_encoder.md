# エンコーダを読む

**目的**: 内界センサの体験。「自分がどれだけ動いたかを知る」。

---

## エンコーダとは

車輪の回転量を数えるセンサです。

車輪が回ると、エンコーダの値が増えていきます。
逆に回すと、値が減ります。

これだけです。やっていることは非常にシンプルです。

### なぜ必要か

前のレッスンで `robot.set_speed(left=100, right=100)` と書きましたが、
実は **本当にその速度で回っているかは分かりません**。

- 床が滑るかもしれない
- バッテリーの電圧が変わるかもしれない
- 負荷がかかっているかもしれない

「命令した」と「実際にそう動いた」は別物です。
エンコーダは「実際にどれだけ動いたか」を教えてくれるセンサです。

---

## Pythonで値を読み取る

```python
# イメージ（実際のコードはロボットのライブラリに依存）
left_enc = robot.get_encoder(wheel="left")
right_enc = robot.get_encoder(wheel="right")
print(f"左: {left_enc}, 右: {right_enc}")
```

---

## やってみよう

### 車輪を手で回す

ロボットの電源を入れた状態で、車輪を手で回してみましょう。

```python
import time

for i in range(10):
    left_enc = robot.get_encoder(wheel="left")
    print(f"左エンコーダ: {left_enc}")
    time.sleep(0.5)
```

- 前に回すと値が増える
- 後ろに回すと値が減る
- 速く回すと値の変化が大きい

### 走らせて読む

車輪を回す命令を出しながら、エンコーダの値を読みます。

```python
robot.set_speed(left=100, right=100)
for i in range(20):
    left_enc = robot.get_encoder(wheel="left")
    right_enc = robot.get_encoder(wheel="right")
    print(f"左: {left_enc}, 右: {right_enc}")
    time.sleep(0.1)
robot.set_speed(left=0, right=0)
```

---

## 回転量と移動距離の関係

エンコーダの値は「カウント数」（パルス数）です。
これを「実際にどれだけ移動したか」に変換するには、車輪の大きさが要ります。

直感レベルで:
- 車輪1回転 = エンコーダが一定量増える
- 車輪の円周 = 直径 × π = 1回転あたりの移動距離
- エンコーダの変化量 → 車輪の回転量 → 移動距離

具体的な変換式は大枠3（ホイールオドメトリ）で扱います。
ここでは「エンコーダを読めば、どれだけ動いたか分かる」が伝わればOKです。

---

## 気づいてほしいこと

- エンコーダは「過去にどれだけ動いたか」の累積値
- 読み取りのたびに少しずつ値が変わっていく
- 同じ速度命令でも、左右のエンコーダ値が完全に同じにはならない
  → **現実のセンサには常に誤差がある**

この「誤差が積み上がっていく」問題は、大枠3のホイールオドメトリで
実際に体で感じることになります。

---

**次のレッスン**: → #08 IMUを読む (`01_experience/05_imu`)
